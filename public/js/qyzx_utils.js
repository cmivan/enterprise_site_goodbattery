(function(){var U,UA=navigator.userAgent.toLowerCase();window.__itbu_webim_utils__=U={isWin:(UA.indexOf("windows")!=-1),isIE:(UA.indexOf("msie")!=-1),isIE6:(UA.indexOf("msie 6.0")!=-1),$:function(id){var el=(typeof(id)==="string"?document.getElementById(id):id);if(!el){return null}el.css=U.getStyle(el);return el},$c:function(tagName){return document.createElement(tagName)},getStyle:function(el){return el.currentStyle||window.getComputedStyle(el,null)},getByClassName:function(el,name){if(!el){return null}if(el.getElementsByClassName){return el.getElementsByClassName(name)}var node,nodes=el.getElementsByTagName("*"),re=new RegExp("(?:^| )"+name+"(?:$| )"),ret=[];for(var i=0,len=nodes.length;i<len;i++){node=nodes[i];if(node.nodeType==1&&re.test(node.className)){ret.push(node)}}return ret},addClass:function(el,classname){if(el.className.indexOf(classname)<0){el.className+=" "+classname}return this},removeClass:function(el,classname){var re=new RegExp(" ?"+classname);el.className=el.className.replace(re,"");return this},each:function(collections,callback){if(!collections||!callback){return}var cst=collections.constructor,ret;if(cst==Array||cst==window.NodeList||"length" in collections){for(var i=0,len=collections.length;i<len;i++){ret=callback.call(collections[i],collections[i],i);if(ret===false){break}}}else{if(cst==Object){for(var k in collections){ret=callback.call(collections[k],collections[k],k);if(ret===false){break}}}}},extend:function(source,target){for(var k in source){target[k]=source[k]}return target},domReady:(function(){var _dom={},readyList=[],isReady=false,isReadyBound=false;_dom.ready=function(fn){_dom.bindReady();if(_dom.isFunction(fn)){if(isReady){fn()}else{readyList.push(fn)}}};_dom.bindReady=function(){if(isReadyBound){return}isReadyBound=true;if(document.readyState==="complete"){return setTimeout(_dom.fireReady,100)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);_dom.fireReady()},false);window.addEventListener("load",function(){window.removeEventListener("load",arguments.callee,false);_dom.fireReady()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){document.detachEvent("onreadystatechange",arguments.callee);_dom.fireReady()});window.attachEvent("onload",function(){window.detachEvent("onload",arguments.callee);_dom.fireReady()});var toplevel=false;try{toplevel=window.frameElement==null}catch(e){}if(document.documentElement.doScroll&&toplevel){_dom.doScrollCheck()}}}};_dom.fireReady=function(){if(isReady){return}if(!document.body){return setTimeout(arguments.callee,13)}isReady=true;readyList.reverse();while(readyList.length){readyList.pop().call(this)}};_dom.doScrollCheck=function(){if(isReady){return}try{document.documentElement.doScroll("left")}catch(error){return setTimeout(arguments.callee,1)}setTimeout(_dom.fireReady,100)};_dom.isFunction=function(fn){return Object.prototype.toString.call(fn)==="[object Function]"};return _dom.ready})(),reqByScript:function(url,name,callback){var h=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript";s.src=url;s.charset="GBK";s.onload=s.onerror=s.onreadystatechange=function(){var rs=s.readyState;if(!rs||rs==="loaded"||rs==="complete"){s.onload=s.onerror=s.onreadystatechange=null;s.parentNode.removeChild(s);s=h=null;if(callback){if(name){callback(window[name]);window[name]=null}else{callback()}}}};h.insertBefore(s,null)},reqByImage:function(url,callback){var img=document.createElement("img");img.style.display="none";img.onload=img.onerror=function(){img.onload=img.onerror=null;img.parentNode.removeChild(img);img=null;if(callback){callback()}};document.body.appendChild(img);img.src=url},readCookie:function(cn){var re=new RegExp(cn+"=([^;]+)");return(re.test(document.cookie)?U.unesc(RegExp.$1):"")},saveCookie:function(name,cvMap,domain,path,expires){var vs=[],cookie=[];if(typeof(cvMap)=="object"){for(var k in cvMap){vs.push(k+"="+U.esc(cvMap[k]))}}else{vs=[cvMap]}if(vs.length){cookie.push(name+"="+U.esc(vs.join(", ")))}if(domain){cookie.push("domain="+domain)}if(path){cookie.push("path="+path)}if(expires){cookie.push("expires="+expires)}document.cookie=cookie.join("; ")},on:function(el,type,handler){if(!el){return}if(el.attachEvent){el.attachEvent("on"+type,handler)}else{if(el.addEventListener){el.addEventListener(type,handler,false)}else{el["on"+type]=handler}}},un:function(el,type,handler){if(el.detachEvent){el.detachEvent("on"+type,handler)}else{if(el.removeEventListener){el.removeEventListener(type,handler,false)}else{el["on"+type]=null}}},trigger:function(el,type){if(document.createEvent){var evt=document.createEvent("HTMLEvents");evt.initEvent(type,true,false);return el.dispatchEvent(evt)}if(document.createEventObject){return el.fireEvent("on"+type)}return(el[type])()},stopPropagation:function(evt){if(!evt){evt=window.event}evt.cancelBubble=true;if(evt.stopPropagation){evt.stopPropagation()}},randomGUID:(function(){var RDS="0123456789abcdefghijklmnopqrstuvwxyz".split(""),RDX=RDS.length;return function(len){if(!len){len=20}var rds=RDS,rdx=RDX,arr=new Array(len);for(var i=0;i<len;i++){arr[i]=rds[Math.random()*rdx|0]}return arr.join("")}})(),esc:function(s){return s==null?"":escape(s)},unesc:function(s){return s==null?"":unescape(s)},encode:function(s){return s==null?"":encodeURIComponent(s)},decode:function(s){return s==null?"":decodeURIComponent(s)},htmlEncode:function(s){return s==null?"":s.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},htmlEncode2:function(s){return s==null?"":s.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},htmlDecode:function(s){return(s==null?"":s.replace(/&lt;/g,"<").replace(/&#x3c;/g,"<").replace(/&gt;/g,">").replace(/&#x3e;/g,">").replace(/&amp;/g,"&").replace(/&#x26;/g,"&"))},stripTags:function(v){return !v?"":v.replace(/<\/?[^>]+>/gi,"")},getUrlParameterMap:function(url){var map={};if(!/\?(\S+)/.test(url)){return map}var ps=RegExp.$1.split("&"),re=/^([^=]+)(?:=(.*))?$/;for(var i=ps.length-1;i>=0;i--){if(re.test(ps[i])){map[RegExp.$1]=RegExp.$2}}return map},addStyleSheet:function(url){var head=document.getElementsByTagName("head")[0],script=head.getElementsByTagName("script")[0],link=document.createElement("link");link.rel="stylesheet";link.href=url;head.insertBefore(link,script||null)},getMousePos:function(evt){if("pageX" in evt){var va=U.clientViewArea();return[evt.pageX-va.scrollLeft,evt.pageY-va.scrollTop]}return[evt.clientX,evt.clientY]},setPosition:function(el,sType,iX,iY){var self=arguments.callee,va=U.clientViewArea(),ew=el.width||el.offsetWidth||0,eh=el.height||el.offsetHeight||0,dw=va.width,dh=va.height,sl=va.scrollLeft,st=va.scrollTop,iL=0,iT=0;if(!el.style.position||el.style.position=="fixed"){if(U.isIE6){el.style.position="absolute"}else{sl=st=0}}if(typeof(sType)=="number"){iY=iX||0;iX=sType;el.style.left=sl+iX+"px";el.style.top=st+iY+"px";return{x:iX,y:iY}}if(iX==null){iX=0}if(iY==null){iY=0}if(self._DW){iX=Math.floor(dw*iX/self._DW);iY=Math.floor(dh*iY/self._DH)}else{self._DW=dw;self._DH=dh}switch(sType){case"lt":iL=iX;iT=iY;break;case"tc":iL=Math.floor((dw-ew)/2)+iX;iT=iY;break;case"rt":iL=dw-ew-iX;iT=iY;break;case"rc":iL=dw-ew-iX;iT=Math.floor((dh-eh)/2)+iY;break;case"rb":iL=dw-ew-iX;iT=dh-eh-iY;break;case"bc":iL=Math.floor((dw-ew)/2)+iX;iT=dh-eh+iY;break;case"lb":iL=iX;iT=dh-eh-iY;break;case"lc":iL=iX;iT=Math.floor((dh-eh)/2)+iY;break;case"c":iL=Math.floor((dw-ew)/2)+iX;iT=Math.floor((dh-eh)/2)+iY;break}iL=Math.max(iL,0);iT=Math.max(iT,0);el.style.left=sl+iL+"px";el.style.top=st+iT+"px";return{x:iL,y:iT}},dragDrop:function(mElem,hElem,oCacheXY){if(arguments.length==1){hElem=mElem}else{if(arguments.length==2&&hElem.nodeType===undefined){oCacheXY=hElem;hElem=mElem}}if(!mElem.css.position||(U.isIE6&&mElem.css.position=="fixed")){mElem.style.position="absolute"}var downPos={x:0,y:0},iOffset=0,isMoved=false,oBgLayer,oMove;oBgLayer=document.createElement("div");oBgLayer.unselectable="on";oBgLayer.className="itbu_webIM_dragdrop_bgLayer";document.body.appendChild(oBgLayer);oMove=document.createElement("div");oMove.unselectable="on";oMove.className="itbu_webIM_dragdrop_moveLayer";oMove.style.position=mElem.css.position;document.body.appendChild(oMove);var setFlashDisplay=function(sLeft,sVisibility){var oObjectDiv=hElem.nextSibling;if(oObjectDiv.nodeType!=1){oObjectDiv=oObjectDiv.nextSibling}if(U.isIE){oObjectDiv.firstChild.style.left=sLeft}else{oObjectDiv.firstChild.style.visibility=sVisibility}};var onMousemove=function(evt){U.stopPropagation(evt);if(!isMoved){isMoved=true}var cPos=U.getMousePos(evt||window.event);oMove.style.left=cPos[0]-downPos.x+iOffset+"px";oMove.style.top=cPos[1]-downPos.y-iOffset+"px"};var onMouseup=function(evt){U.stopPropagation(evt);setFlashDisplay("0px","visible");if(isMoved){isMoved=false;mElem.style.left=oMove.style.left;mElem.style.top=oMove.style.top;if(oCacheXY){if(mElem.css.position=="fixed"){oCacheXY.x=mElem.offsetLeft;oCacheXY.y=mElem.offsetTop}else{var de=U.clientViewArea();oCacheXY.x=mElem.offsetLeft-de.scrollLeft;oCacheXY.y=mElem.offsetTop-de.scrollTop}}}oMove.style.display="none";oBgLayer.style.display="none";U.un(oMove,"mousemove",onMousemove);U.un(oBgLayer,"mousemove",onMousemove)};U.on(hElem,"mousedown",function(evt){U.stopPropagation(evt);if(evt.button==2){return}setFlashDisplay("-400px","hidden");var cPos=U.getMousePos(evt||window.event),el=mElem.offsetLeft,et=mElem.offsetTop,de=U.clientViewArea();downPos.x=cPos[0]-el;downPos.y=cPos[1]-et;oMove.style.display="block";oBgLayer.style.display="block";oBgLayer.style.left=de.scrollLeft+"px";oBgLayer.style.top=de.scrollTop+"px";oBgLayer.style.width=de.width+"px";oBgLayer.style.height=de.height+"px";oMove.style.left=el+iOffset+"px";oMove.style.top=et-iOffset+"px";oMove.style.width=mElem.offsetWidth-4+"px";oMove.style.height=mElem.offsetHeight-4+"px";U.un(oMove,"mousemove",onMousemove);U.un(oBgLayer,"mousemove",onMousemove);U.on(oMove,"mousemove",onMousemove);U.on(oBgLayer,"mousemove",onMousemove)});U.on(oMove,"mouseup",onMouseup);U.on(oBgLayer,"mouseup",onMouseup)},flash:(function(){var sContainerModel=('<div id="{0}" unselectable="on" style="{1}">  <div unselectable="on" style="{2}">    <div unselectable="on" style="{3}"></div>    <div unselectable="on" style="{4}"></div>  </div>  <div unselectable="on" style="{5}"></div></div>'),SHOCKWAVE_FLASH="Shockwave Flash",FLASH_MIME_TYPE="application/x-shockwave-flash",nav=navigator,isIE=(UA.indexOf("msie")!=-1),playerVersion=[0,0,0],flash_model,d;if(isIE){flash_model=('<object  id="{0}"  classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"  hidefocus="true" style="position:relative; overflow:hidden; height:{3}; width:{4}; margin:0px; outline:none; z-index:1;">    <param name="movie" value="{1}" />    <param name="flashvars" value="{2}"/>	 <param name="wmode" value="{5}"/>	 <param name="menu" value="false"/>    <param name="quality" value="high"/>    <param name="bgcolor" value="#ffffff"/>    <param name="allowScriptAccess" value="always"/></object>')}else{flash_model=('<object  id="{0}"  type="application/x-shockwave-flash"  data="{1}"  hidefocus="true" style="position:relative; overflow:hidden; height:{3}; width:{4}; margin:0px; outline:none; z-index:1;">	<param name="flashVars" value="{2}"/>	<param name="wmode" value="{5}"/>	<param name="menu" value="false"/>	<param name="quality" value="high"/>	<param name="bgcolor" value="#ffffff"/>	<param name="allowScriptAccess" value="always"/></object>')}if(typeof nav.plugins!=undefined&&typeof nav.plugins[SHOCKWAVE_FLASH]=="object"){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=undefined&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(window.ActiveXObject){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a){d=a.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}}catch(e){}}}function createFlash(oArg){var va=U.clientViewArea();var sDefContainerStyle=String.format("overflow:hidden; height:1px; width:1px; position:absolute; left:{0}px; top:{1}px;",va.scrollLeft,va.scrollTop),sFlashModel=String.format(flash_model,oArg.id||"",oArg.src||"",oArg.flashVars||"",oArg.height||"1px",oArg.width||"1px",oArg.wmode||""),sContainerID="oContainer_"+U.randomGUID(),_sContainerModel=String.format(sContainerModel,sContainerID,oArg.containerStyle||sDefContainerStyle,oArg.titleBarStyle||"",oArg.titleTxtStyle||"",oArg.closeButtonStyle||"",oArg.objectDivStyle||""),oContainer=U.$c("div");if(U.isWin&&U.isIE){document.body.appendChild(oContainer);oContainer.outerHTML=_sContainerModel;oContainer=U.$(sContainerID);var oFlashDiv=U.$c("div");oContainer.lastChild.appendChild(oFlashDiv);oFlashDiv.outerHTML=sFlashModel}else{document.body.appendChild(oContainer);oContainer.innerHTML=_sContainerModel;document.body.replaceChild(oContainer.lastChild,oContainer);oContainer=U.$(sContainerID);oContainer.lastChild.innerHTML=sFlashModel}oContainer.removeAttribute("id")}function hasPlayerVersion(sVersion){var pv=playerVersion,v=sVersion.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))}return{version:playerVersion.join("."),hasVersion:function(sVersion){return this.isInstall()&&hasPlayerVersion(sVersion)},create:function(oArg){createFlash(oArg)},isInstall:function(){return this.version!="0.0.0"}}})(),JSON:(function(){function toJSONString(obj){var self=arguments.callee,sType=typeof(obj);if(sType=="object"){if(obj==null){return null}if(obj.constructor==Object){var arr=[];for(var k in obj){arr.push('"'+k+'":'+self(obj[k]))}return"{"+arr.join(",")+"}"}if(obj.constructor==Array){var arr=[];for(var i=0,len=obj.length;i<len;i++){arr[i]=self(obj[i])}return"["+arr.join(",")+"]"}if(obj.constructor==Date){return self(obj.toUTCString())}if(obj.constructor==RegExp){return self(obj.source)}return self(String(obj))}if(sType=="string"){return'"'+obj.replace(/\"/g,'\\"')+'"'}if(sType=="function"){return null}if(sType=="undefined"){return null}return obj}return{stringify:function(obj){return toJSONString(obj)},parse:function(jsonStr){return jsonStr&&eval("("+jsonStr+")")}}})(),logger:(function(){var loggerEnabled=false,isAvailable=!!window.console;function now(){var o=new Date(),y=o.getFullYear(),M=o.getMonth()+1,d=o.getDate(),h=o.getHours(),m=o.getMinutes(),s=o.getSeconds();return(fm(y)+"-"+fm(M)+"-"+fm(d)+" "+fm(h)+":"+fm(m)+":"+fm(s))}function fm(n){return(n<10?"0":"")+n}function basicLogging(level,varArgs){if(!isAvailable||!loggerEnabled||!varArgs.length){return}if(typeof(console[level])=="function"){if(U.isIE){(console[level])(varArgs)}else{(console[level])("<"+now()+"> ",Array.prototype.slice.call(varArgs,0).join(", "))}}}return{log:function(){basicLogging("log",arguments)},debug:function(){basicLogging("debug",arguments)},warn:function(){basicLogging("warn",arguments)},error:function(){basicLogging("error",arguments)},enabled:function(){loggerEnabled=true}}})(),getUrlDomain:function(sUrl){if(!sUrl){return""}var s=sUrl.indexOf("//")+2,e=sUrl.indexOf("/",s);if(e==-1){e=sUrl.length}var ret=sUrl.substring(s,e);e=ret.lastIndexOf(":");return e==-1?ret:ret.substring(0,e)},clientViewArea:function(){var b=document.compatMode!=="BackCompat",de=document.documentElement,db=document.body;return{height:b?de.clientHeight:db.clientHeight,width:b?de.clientWidth:db.clientWidth,scrollLeft:b?de.scrollLeft:db.scrollLeft,scrollTop:b?de.scrollTop:db.scrollTop,isStandard:b}},elAnimate:(function(){function now(){return(new Date()).getTime()}function swing(p){return(-Math.cos(p*Math.PI)/2)+0.5}function getCssValue(el,prop){return(el.currentStyle||window.getComputedStyle(el,null))[prop]}var _speed=300;return function(el,prop,end,speed,callback){if(typeof(el)==="string"){el=document.getElementById(el)}if(el.timerId){clearInterval(el.timerId)}if(speed==null){speed=_speed}else{if(typeof(speed)==="function"){callback=speed;speed=_speed}}var startTime=now(),oStyle=el.style,start=parseFloat(getCssValue(el,prop));el.timerId=setInterval(function(){var time=now(),state=(time-startTime)/speed,_now=start+(end-start)*swing(state);if(time>=speed+startTime){oStyle[prop]=end+"px";clearInterval(el.timerId);el.timerId=null;if(callback){callback.call(el)}}else{oStyle[prop]=_now+"px"}},13)}})(),alitalk:(function(){var msie=(UA.indexOf("msie")!=-1);function checkVersion(){if(!msie){return 0}var activexs=[{activex:"aliimx.wangwangx",version:6},{activex:"Ali_Check.InfoCheck",version:5}];for(var i=0;i<activexs.length;i++){var obj=activexs[i];try{new window.ActiveXObject(obj.activex);return obj.version}catch(e){}}return 0}function reqByFrame(url){var sID="oWebIM2_WWClientFrame",oFrame=document.getElementById(sID);if(oFrame){oFrame.parentNode.removeChild(oFrame)}oFrame=document.createElement("iframe");oFrame.id=sID;oFrame.src=url;oFrame.style.width="0px";oFrame.style.height="0px";oFrame.style.border="none";oFrame.style.overflow="hidden";document.body.appendChild(oFrame)}return{version:checkVersion(),canTalk:function(){return this.version!==0},talk:function(uid,online,site,props){if(online==null){online=1}if(site==null){site="cnalichn"}if(props==null){props=""}if(this.version===6){if(online===4){reqByFrame("aliim:smssendmsg?touid="+site+uid+props)}else{reqByFrame("aliim:sendmsg?touid="+site+uid+"&siteid="+site+"&status="+online+props)}return true}if(this.version===5){reqByFrame("Alitalk:Send"+(online===4?"Sms":"IM")+"?"+uid+"&siteid="+site+"&status="+online+props);return true}return false},getAlitalk:function(){window.open("http://alitalk.alibaba.com.cn/","_blank")},autoLogin:function(uid){reqByFrame(this.version===5?"alitalk:":("aliim:login?uid="+uid))}}})(),clientScreen:{width:window.screen.width,height:window.screen.height,isHighResolution:function(){return this.width>1024}},pluginManager:(function(){var NAMES={},LOADEDS={},loadPlugin=function(ctx,name,url){if(LOADEDS[name]){return}U.reqByScript(url,null,function(){LOADEDS[name]=true;U.pluginManager.exec(name,ctx)})};return{blockCounter:0,register:function(name,entry){NAMES[name]=entry},exec:function(name){var entry=NAMES[name];if(entry){entry.apply(window,Array.prototype.slice.call(arguments,1))}},unblock:function(){if(this.blockCounter>0){this.blockCounter--}},load:function(ctx,plugins){var mgr=this;U.each(plugins,function(p){var callback=function(){if(p.block===true){mgr.blockCounter++}loadPlugin(ctx,p.name,p.url)};if(p.condition){p.condition(callback)}else{callback()}})}}})()};String.format=(function(){var re=/\{(\d+)\}/g;return function(){var str=arguments[0],args=Array.prototype.slice.call(arguments,1);if(str==null){return}return str.replace(re,function(m,i){return args[i]!=null?args[i]:m})}})();String.ellipsis=function(s,byteLength,nowrapper){if(s==null){return""}if(s.getByteLength()<=byteLength){return s}var ss=s.getSubStr(byteLength);if(ss===s){return s}if(nowrapper===true){return ss+"..."}return String.format('<b title="{0}" style="font-weight:normal;margin:0px;padding:0px;">{1}...</b>',s,ss)};String.prototype.getByteLength=function(){var re=/[^x00-xff]/,len=0;for(var i=this.length-1;i>=0;i--){len+=re.test(this.charAt(i))?2:1}return len};String.prototype.getSubStr=function(byteLength){var re=/[^x00-xff]/,len=0,str="",tmp;for(var i=0;i<this.length;i++){tmp=this.charAt(i);str+=tmp;len+=re.test(tmp)?2:1;if(len>=byteLength){break}}return str}})();